<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.12.0">
<title>Personal Counter</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.3268c726.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.3268c726.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.e7afcba6.js">
<link rel="modulepreload" href="./_observablehq/runtime.8eb97cbb.js">
<link rel="modulepreload" href="./_observablehq/stdlib.8048ec16.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.9d076414.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.16/e828d8c8.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/063eb405.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/c68fbd73.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/7055d4c5.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/a62ae5ce.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e95f898e.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/d44feff9.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/5830b12a.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/84d7b8e9.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/2c0cdfa2.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/626bedc4.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/00c41b5d.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/b5f7cdc6.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/b22c5864.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/407f7a1f.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/6f15f633.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/ef1ec490.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e1ff060.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/5851d7ef.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/dcd02767.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/f1db2593.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/034b7bcb.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/4bb53638.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/bbafde58.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/aa5b35a8.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/32c7fec2.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/567840a0.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/cf9b720b.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/5dcd62f4.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/f8e03c56.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/5bc129e1.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/19c92b44.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/f31b5398.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/8debb4ba.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/4b0cc581.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/1ee6c50d.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/5eed35fd.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/e67acb27.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/8ac9039b.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.e7afcba6.js";

define({id: "45199d8d", outputs: ["version"], body: () => {
const version =  'v1.0.2.0'
return {version};
}});

define({id: "5ca4f385", mode: "inline", inputs: ["version","display"], body: async (version,display) => {
display(await(
version
))
}});

define({id: "a77b92ca", inputs: ["view","Inputs"], outputs: ["hrs_base"], body: (view,Inputs) => {
const hrs_base = view(Inputs.radio(new Map([
    ['<= 29', 1756],
    ['30-39', 1732],
    ['>= 40', 1700],
    ])))

return {hrs_base};
}});

define({id: "d1b1e970", inputs: ["view","Inputs","hrs_base"], outputs: ["seltitle"], body: (view,Inputs,hrs_base) => {
var seltitle = view(Inputs.radio(new Map([
  ['Lektor', {'base':0.1, "research": 0.3, "teaching": 0.7, "dev": 0}],
  ['Lektor med docentkompetens', {'base': 0.1, "research" : 0.35, "teaching": 0.65, "dev": 0}],
  ['Professor', {'base': 0.05, "research" : 0.51, "teaching": 0.49, "dev": 0}],
  ['Biträdande Lektor', {'base': 0.05, "research" : 0.51, "teaching": 0.49, "dev": 0}],
  ['Adjunkt', {'base': 0.1, "research" : 0, "teaching": 0.90, "dev": 0.1}],
]),
{disabled : hrs_base == null, width: 500
}))
return {seltitle};
}});

define({id: "655b8f3e", inputs: ["seltitle"], outputs: ["notitle","title"], body: (seltitle) => {
const notitle = {'base':0.00, "research": 0, "teaching": 0, "dev": 0}
const title = seltitle != null ? seltitle  : notitle
return {notitle,title};
}});

define({id: "16f00750", inputs: ["title"], outputs: ["max_research_percent"], body: (title) => {
const max_research_percent = 1 - title['base'] - 0.2
return {max_research_percent};
}});

define({id: "5cf4415a", inputs: ["view","Inputs","title","notitle"], outputs: ["deltid"], body: (view,Inputs,title,notitle) => {
const deltid = view(Inputs.range([5, 100],
  {
    'step': 1,
      disabled : title == notitle,
    width: 500,
    value: 100
    }))
return {deltid};
}});

define({id: "8728c716", inputs: ["view","Inputs","max_research_percent","title","notitle"], outputs: ["bidrag"], body: (view,Inputs,max_research_percent,title,notitle) => {
const bidrag = view(Inputs.range([0, Math.round(max_research_percent * 100)],
  {
    'step': 1,
    disabled : title == notitle,
    width: 500
    }))
return {bidrag};
}});

define({id: "1c397390", inputs: ["hrs_base","deltid"], outputs: ["hrs"], body: (hrs_base,deltid) => {
const hrs = hrs_base * deltid / 100
return {hrs};
}});

define({id: "89af9455", inputs: ["title","hrs"], outputs: ["granted_hours"], body: (title,hrs) => {
const granted_hours = title['base'] * hrs
return {granted_hours};
}});

define({id: "c60932db", inputs: ["hrs","title"], outputs: ["remaining"], body: (hrs,title) => {
const remaining = hrs * (1 - title['base'])
return {remaining};
}});

define({id: "6e75528a", inputs: ["bidrag"], outputs: ["financed"], body: (bidrag) => {
const  financed = bidrag / 100
return {financed};
}});

define({id: "b4e5f40d", inputs: ["financed","title","hrs"], outputs: ["used","research_reserve","unused","teaching","other_research","all_research","total","teachp","basep","re_allp","re_finp","re_othp","totp","re_allt","tott"], body: (financed,title,hrs) => {
const used = financed + title['base']

const research_reserve = title['base'] == 0.05 ? 0.05 : 0
const unused = 1 - used - research_reserve


const teaching = Math.min(
    Math.max(0.2, unused * title['teaching']),
    1 - title['base'] - title['dev'] - title['research'])
const other_research = unused - teaching + research_reserve
const all_research = other_research + financed
const total = teaching + title['base'] + all_research

const teachp = Math.round(teaching * 100)
const basep = Math.round(title['base'] * 100)
const re_allp = Math.round(all_research * 100)
const re_finp = Math.round(financed * 100)
const re_othp = Math.round(other_research * 100)
const totp = Math.round(total * 100)

const re_allt = Math.round(all_research * hrs)

const tott = Math.round(total * hrs)
return {used,research_reserve,unused,teaching,other_research,all_research,total,teachp,basep,re_allp,re_finp,re_othp,totp,re_allt,tott};
}});

define({id: "89f54fa2", inputs: ["basep","teachp","re_othp","bidrag","hrs"], outputs: ["data","calculateHours"], body: (basep,teachp,re_othp,bidrag,hrs) => {
var data = [
  {'name': '1. Övrig tid ', 'percent': basep},
  {'name': '2. Undervisning', 'percent': teachp},
  {'name': '3. Forskning - Fakultet*', 'percent': re_othp},
  {'name': '4. Forskning - Bidrag', 'percent': bidrag},
]

function calculateHours(item, index, arr) {
  arr[index]['hours'] = Math.round(arr[index]['percent'] * hrs/100);
}

data.forEach(calculateHours)

return {data,calculateHours};
}});

define({id: "e8aaa3a3", mode: "inline", inputs: ["resize","Plot","data","display"], body: async (resize,Plot,data,display) => {
display(await(
    resize((width) => Plot.plot({
      height: Math.max(100, width/10),
      width: width,
      color: { legend: true, scheme: "Dark2"},
      marks: [
        Plot.barX(data, {
          x: 'percent', fill: "name"}),
      ]
    }))
  
))
}});

define({id: "755820dc", inputs: ["display","data","re_allp","re_allt","totp","tott"], body: (display,data,re_allp,re_allt,totp,tott) => {
display(
  `\nÖvrig tid:    ${data[0]['percent']}% (${data[0]['hours']} h)\nUndervisning: ${data[1]['percent']}% (${data[1]['hours']} h)\nForskning:    ${re_allp}% (${re_allt} h)\n    Varav bidrag:    ${data[3]['percent']}% (${data[3]['hours']} h)\n    Varav Fakultet*: ${data[2]['percent']}% (${data[2]['hours']} h)\n\nTotal: ${totp}% (${tott} h)`
)
}});

define({id: "e3345720", outputs: ["toggleDivVisibility"], body: () => {
function toggleDivVisibility(div_id, display_var) {
  var div = document.getElementById(div_id)

  if (display_var == null || display_var == 0) {
    div.style.visibility = 'hidden';
  } else {
    div.style.visibility = 'visible';
  }
}

return {toggleDivVisibility};
}});

define({id: "bddfab69", inputs: ["toggleDivVisibility","hrs","data","tott"], body: (toggleDivVisibility,hrs,data,tott) => {
//| echo: false

toggleDivVisibility('hrs', hrs)

toggleDivVisibility('other', data[0]['hours'])

toggleDivVisibility('teach', data[1]['hours'])

toggleDivVisibility('research', tott)

}});

define({id: "192e2e6a", mode: "inline", inputs: ["hrs","display"], body: async (hrs,display) => {
display(await(
Math.max(0, hrs).toLocaleString("sv-SE")
))
}});

define({id: "38e1575d", mode: "inline", inputs: ["data","display"], body: async (data,display) => {
display(await(
Math.max(0, data[0]['percent']).toLocaleString("sv-SE")
))
}});

define({id: "169b7d75", mode: "inline", inputs: ["data","display"], body: async (data,display) => {
display(await(
Math.max(0, data[0]['hours']).toLocaleString("sv-SE")
))
}});

define({id: "9a8659d5", mode: "inline", inputs: ["data","display"], body: async (data,display) => {
display(await(
Math.max(0, data[1]['percent']).toLocaleString("sv-SE")
))
}});

define({id: "1514e89a", mode: "inline", inputs: ["data","display"], body: async (data,display) => {
display(await(
Math.max(0, data[1]['hours']).toLocaleString("sv-SE")
))
}});

define({id: "cbbcaefa", mode: "inline", inputs: ["re_allp","display"], body: async (re_allp,display) => {
display(await(
Math.max(0, re_allp).toLocaleString("sv-SE")
))
}});

define({id: "6a9837cd", mode: "inline", inputs: ["re_allt","display"], body: async (re_allt,display) => {
display(await(
Math.max(0, re_allt).toLocaleString("sv-SE")
))
}});

</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<div class="observablehq observablehq--block"><!--:45199d8d:--></div>
<div style="float: right"><observablehq-loading></observablehq-loading><!--:5ca4f385:--></div>
<h2>Beräkningsverktyg</h2>
<!-- Text? -->
<h5>1. Hur gammal är du?</h5>
<div class="observablehq observablehq--block"><!--:a77b92ca:--></div>
<h5>2. Vilken anställningsform har du?</h5>
<div class="observablehq observablehq--block"><!--:d1b1e970:--></div>
<div class="observablehq observablehq--block"><!--:655b8f3e:--></div>
<div class="observablehq observablehq--block"><!--:16f00750:--></div>
<h5>3. Hur stor omfattning har din anställning?</h5>
<div class="observablehq observablehq--block"><!--:5cf4415a:--></div>
<h5>4. Hur stor andel bidragsfinansierad forskning har du?</h5>
<div class="observablehq observablehq--block"><!--:8728c716:--></div>
<div class="observablehq observablehq--block"><!--:1c397390:--></div>
<div class="observablehq observablehq--block"><!--:89af9455:--></div>
<div class="observablehq observablehq--block"><!--:c60932db:--></div>
<div class="observablehq observablehq--block"><!--:6e75528a:--></div>
<div class="observablehq observablehq--block"><!--:b4e5f40d:--></div>
<div class="observablehq observablehq--block"><!--:89f54fa2:--></div>
<div class="grid grid-cols-1">
  <div class="card"><observablehq-loading></observablehq-loading><!--:e8aaa3a3:--></div>
</div>
<h4>  Summering i procent och timmar </h4>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:755820dc:--></div>
<style>

.hero {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-family: var(--sans-serif);
  margin: 4rem 0 8rem;
  text-wrap: balance;
  text-align: center;
}

.hero h1 {
  margin: 1rem 0;
  padding: 1rem 0;
  max-width: none;
  font-size: 14vw;
  font-weight: 900;
  line-height: 1;
  background: linear-gradient(30deg, var(--theme-foreground-focus), currentColor);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero h2 {
  margin: 0;
  max-width: 34em;
  font-size: 20px;
  font-style: initial;
  font-weight: 500;
  line-height: 1.5;
  color: var(--theme-foreground-muted);
}

@media (min-width: 640px) {
  .hero h1 {
    font-size: 90px;
  }
}

</style>
<div class="observablehq observablehq--block"><!--:e3345720:--></div>
<div class="observablehq observablehq--block"><!--:bddfab69:--></div>
<div class="grid grid-cols-4 gap-4">
  </div>
  <div class="card" id="hrs">
    <h2>Timmar</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:192e2e6a:--></span>
  </div>
  <div class="card" id="other">
    <h2>Övrig tid (<observablehq-loading></observablehq-loading><!--:38e1575d:--> %)</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:169b7d75:--></span>
  </div>
  <div class="card" id="teach">
    <h2>Undervisning (<observablehq-loading></observablehq-loading><!--:9a8659d5:--> %)</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:1514e89a:--></span>
  </div>
  <div class="card" id="research">
    <h2>Forskning* (<observablehq-loading></observablehq-loading><!--:cbbcaefa:--> %)</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:6a9837cd:--></span>
  </div>

<p>* För adjunkter avses kompetensutveckling</p>
</main>
<footer id="observablehq-footer">
<div><div style="float: left">© 2024 Mathias Johansson &amp; Institutionen för kulturvetenskaper, Lunds universitet</div><div style="float: right"> Built with observable</div><div style="margin: 0 auto; width: 100px;"><a href="https://github.com/mathjoha/Kultur_Personalplaneraren/issues/new" target="_blank" rel="noopener noreferrer">Report Issue</a><a></a></div></div>
</footer>
</div>
